<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Ayda's Garden 2.0</title>
    <style>
        /* --- [Font Import - Optional but nice] --- */
        /* @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap'); */

        /* --- Base Styles --- */
        body {
            margin: 0;
            padding: 0;
            /* Updated Font Stack: Cleaner Sans-serif */
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            /* Optional: Use imported font -> font-family: 'Nunito', sans-serif; */
            background-color: #e6f7ff;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 1s ease;
            /* Prevent text selection on UI elements for better mobile interaction */
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            /* Improve rendering performance on mobile */
             -webkit-font-smoothing: antialiased;
             -moz-osx-font-smoothing: grayscale;
        }

        .header {
            background-color: #ff9d5c;
            color: white;
            text-align: center;
            padding: 10px 15px; /* Slightly reduced padding */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }

        h1 {
            margin: 0;
            font-size: 2.0em; /* Slightly reduced base size */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2); /* Adjusted shadow */
        }

        .garden-container {
            flex: 1;
            position: relative;
            overflow: hidden;
             /* Keep original cursor for desktop, mobile will use touch */
             cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="%23964B00" stroke="%23964B00" stroke-width="2"><path d="M7 17l3-3 5 5 5-5-3-3 3-3-5-5-3 3-3-3-5 5 3 3-3 3z"/></svg>'), auto;
        }

        /* --- Sky, Ground, Horizon --- */
        /* [No changes needed here unless specific visual scaling is desired] */
         .sky { position: absolute; top: 0; left: 0; width: 100%; height: 33%; background: linear-gradient(to bottom, #87CEEB, #B0E0E6); z-index: 0; transition: background 1s ease; overflow: hidden; }
         .ground { position: absolute; top: 33%; left: 0; width: 100%; height: 67%; background: linear-gradient(to bottom, #a3d9a5 0%, #7bb990 100%); z-index: 1; transition: background 1s ease; overflow: hidden; }
         .horizon { position: absolute; top: 33%; left: 0; width: 100%; height: 4px; background: linear-gradient(to bottom, #B0E0E6, #a3d9a5); z-index: 1; transition: background 1s ease; }

        /* --- Seasonal & Day/Night Styles --- */
        /* [No fundamental changes needed for responsiveness here, inherits from body] */
         body.fall .sky { background: linear-gradient(to bottom, #c1d4e0, #d3e0eb); }
         body.fall .ground { background: linear-gradient(to bottom, #d2b48c 0%, #b8860b 100%); }
         body.fall .horizon { background: linear-gradient(to bottom, #d3e0eb, #d2b48c); }
         body.fall .leaf { background-color: #d2691e; }
         body.winter .sky { background: linear-gradient(to bottom, #e0f2f7, #f0f8ff); }
         body.winter .ground { background: linear-gradient(to bottom, #ffffff 0%, #f5f5f5 100%); }
         body.winter .horizon { background: linear-gradient(to bottom, #f0f8ff, #ffffff); }
         body.winter .leaf { display: none; }
         body.night .sky { background: linear-gradient(to bottom, #000030, #202060); }
         body.night .ground { background: linear-gradient(to bottom, #304040 0%, #102020 100%); }
         body.night .horizon { background: linear-gradient(to bottom, #202060, #304040); }
         body.night .cloud { background-color: rgba(100, 100, 120, 0.5); }
         body.night .flower-center { box-shadow: 0 0 8px 2px gold; } /* Slightly smaller glow */
         body.night .petal { filter: brightness(0.8); }
         .star { position: absolute; width: 2px; height: 2px; background-color: white; border-radius: 50%; opacity: 0; animation: twinkle 2s infinite alternate; transition: opacity 1s ease; z-index: 0; }
         body.night .star { opacity: 1; }
         @keyframes twinkle { from { opacity: 0.5; transform: scale(0.8); } to { opacity: 1; transform: scale(1.2); } }
         .snowflake { position: absolute; width: 8px; height: 8px; background-color: rgba(255, 255, 255, 0.8); border-radius: 50%; opacity: 0; animation: fall linear infinite; z-index: 5; pointer-events: none; }
         body.winter .snowflake { opacity: 1; }
         @keyframes fall { 0% { transform: translateY(-10px) translateX(0px); opacity: 1; } 100% { transform: translateY(calc(100vh * 0.67 + 10px)) translateX(20px); opacity: 0; } }


        /* --- Flower & Related Styles --- */
        /* [Minor adjustments might be needed if flowers feel too big/small on mobile] */
        .flower { position: absolute; transform: translate(-50%, -100%); transition: all 0.5s ease; cursor: pointer; z-index: 2; height: 100px; width: 40px; }
         .water-meter-container { position: absolute; width: 50px; height: 8px; background-color: rgba(255, 255, 255, 0.5); border-radius: 4px; bottom: -15px; left: 50%; transform: translateX(-50%); overflow: hidden; z-index: 3; border: 1px solid rgba(0, 0, 0, 0.2); }
         .water-meter-fill { height: 100%; width: 0%; background: linear-gradient(to right, #87CEFA, #1E90FF); border-radius: 4px; transition: width 0.5s ease; }
         .flower-stem { width: 4px; height: 60px; background-color: #3c7c3c; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); z-index: 1; transition: all 0.5s ease; }
         .flower-head { width: 40px; height: 40px; position: absolute; top: 0; left: 50%; transform: translateX(-50%); z-index: 3; transition: all 0.5s ease; }
         .petal { width: 15px; height: 15px; border-radius: 50% 50% 50% 50%; background-color: orange; position: absolute; z-index: 2; transition: all 0.5s ease; }
         .petal:nth-child(1) { top: -7px; left: 12px; } .petal:nth-child(2) { top: 0px; left: 25px; } .petal:nth-child(3) { top: 12px; left: 32px; } .petal:nth-child(4) { top: 25px; left: 25px; } .petal:nth-child(5) { top: 32px; left: 12px; } .petal:nth-child(6) { top: 25px; left: 0px; } .petal:nth-child(7) { top: 12px; left: -7px; } .petal:nth-child(8) { top: 0px; left: 0px; }
         .flower-center { width: 15px; height: 15px; border-radius: 50%; background-color: #FFD700; position: absolute; top: 12px; left: 12px; z-index: 4; transition: all 0.5s ease; }
         .leaf { width: 20px; height: 10px; background-color: #5fa357; border-radius: 10px 10px 0 0; position: absolute; top: 20px; z-index: 2; transition: all 0.5s ease; }
         .leaf.left { transform: rotate(-45deg); left: -15px; } .leaf.right { transform: rotate(45deg); right: -15px; }
         .flower-message { position: absolute; background-color: rgba(255, 255, 255, 0.95); /* Slightly more opaque */ padding: 8px; /* Adjust padding */ border-radius: 8px; box-shadow: 0 0 8px rgba(0, 0, 0, 0.2); max-width: 130px; /* Adjust width */ font-size: 0.8em; /* Slightly smaller font */ text-align: center; z-index: 100; border: 1px solid #ff9d5c; /* Thinner border */ transform: translateX(-50%); opacity: 0; transition: opacity 0.5s ease; pointer-events: none; bottom: 110px; /* Adjusted position */ left: 50%; }
         .flower-message:after { content: ""; position: absolute; bottom: -8px; /* Adjust arrow position */ left: 50%; transform: translateX(-50%); border-width: 8px 8px 0; border-style: solid; border-color: rgba(255, 255, 255, 0.95) transparent transparent; }


        /* --- Butterflies, Clouds --- */
        /* [No fundamental changes needed] */
        .butterfly { position: absolute; width: 30px; height: 30px; z-index: 10; cursor: pointer; }
        .butterfly-wing { position: absolute; width: 15px; height: 20px; border-radius: 50% 50% 0 50%; top: 5px; left: 7px; transform-origin: right center; animation: flutter-right 0.2s infinite alternate; }
        .butterfly-wing:nth-child(2) { left: auto; right: 7px; border-radius: 50% 50% 50% 0; transform-origin: left center; animation: flutter-left 0.2s infinite alternate; }
        .butterfly-body { position: absolute; width: 4px; height: 20px; background-color: black; left: 13px; top: 5px; z-index: 1; }
        @keyframes flutter-right { from { transform: rotateY(0deg); } to { transform: rotateY(40deg); } }
        @keyframes flutter-left { from { transform: rotateY(0deg); } to { transform: rotateY(-40deg); } }
        .cloud { position: absolute; background-color: rgba(255, 255, 255, 0.8); border-radius: 50%; pointer-events: none; transition: background-color 1s ease; }


        /* --- UI Elements --- */
        .controls {
            position: fixed;
            bottom: 10px; /* Closer to bottom */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-wrap: wrap; /* Allow buttons to wrap */
            justify-content: center; /* Center wrapped buttons */
            gap: 8px; /* Adjust gap */
            background: rgba(255, 255, 255, 0.8); /* Slightly more opaque */
            padding: 8px; /* Adjust padding */
            border-radius: 15px; /* Soften radius */
            z-index: 20; /* Ensure controls are on top */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            width: 95%; /* Limit width on larger screens */
            max-width: 600px; /* Max width for button container */
            box-sizing: border-box; /* Include padding in width */
        }

        .controls button {
            padding: 10px 12px; /* Adjust padding */
            /* font-family: 'Nunito', sans-serif; */ /* Optional: Use imported font */
            font-size: 0.9em; /* Adjust font size */
            font-weight: bold; /* Make text bolder */
            border-radius: 10px; /* Soften radius */
            border: none;
            cursor: pointer;
            background-color: #ff9d5c;
            color: white;
            transition: all 0.3s ease;
            flex-grow: 1; /* Allow buttons to grow slightly */
            text-align: center;
             /* Prevent double-tap zoom on mobile */
             touch-action: manipulation;
        }

        .controls button:hover,
        .controls button:active { /* Style active state for mobile tap feedback */
            background-color: #ff7f2a;
            transform: scale(1.03); /* Slightly different feedback */
        }

        .controls button.active {
            background-color: #4286f4;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); /* Inset shadow for active */
        }

        /* Positioning for Message Box, Counter, Instructions */
        .message-container,
        .counter,
        .instructions,
        .achievement-menu {
             position: fixed; /* Keep fixed positioning */
             z-index: 100; /* Ensure they are above garden elements */
             background: rgba(255, 255, 255, 0.9); /* More opaque background */
             border-radius: 10px; /* Consistent radius */
             box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
             padding: 10px 12px;
        }

        .message-container {
            top: 15px; /* Closer to top */
            left: 15px;
            transform: none; /* Reset transform */
            max-width: 70%; /* Allow more width */
            border: 2px solid #ff9d5c;
            display: none;
            text-align: left; /* Align text left */
        }
         .message-text { font-size: 0.95em; margin-bottom: 8px; } /* Adjust font size */
         .close-button { background-color: #ff9d5c; color: white; border: none; padding: 6px 12px; border-radius: 8px; cursor: pointer; font-size: 0.9em; transition: all 0.3s ease; display: block; /* Make it block */ margin-top: 5px; /* Add margin */ }
         .close-button:hover { background-color: #ff7f2a; transform: scale(1.05); }


        .counter {
            top: 15px;
            right: 15px;
            font-size: 1.0em; /* Adjust size */
            color: #ff9d5c;
        }

        .instructions {
            /* Position below counter or message box? Let's try bottom */
            bottom: 75px; /* Position above controls */
            left: 15px; /* Align left */
            right: auto; /* Reset right */
             /* transform: translateX(-50%); /* Center it? No, keep left */
             max-width: calc(100% - 30px); /* Limit width */
             box-sizing: border-box;
             font-size: 0.85em; /* Smaller font */
            color: #333;
            text-align: center; /* Center text within the box */
        }


        /* --- New Feature Styles (Creatures, Achievements, Weather, Minigames) --- */
        /* [Adjust sizes/positions if needed for mobile] */
         .rabbit { position: absolute; width: 35px; height: 44px; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50 95c-10 0-20-5-20-15 0-5 5-10 10-10h20c5 0 10 5 10 10 0 10-10 15-20 15z" fill="%23D3D3D3"/><ellipse cx="50" cy="65" rx="25" ry="20" fill="white"/><circle cx="40" cy="60" r="4" fill="black"/><circle cx="60" cy="60" r="4" fill="black"/><path d="M48 70 q 4 4 8 0" stroke="pink" stroke-width="2" fill="none"/><path d="M30 40 Q 25 10 40 15 Q 35 40 30 40z" fill="white"/><path d="M70 40 Q 75 10 60 15 Q 65 40 70 40z" fill="white"/></svg>'); background-size: contain; background-repeat: no-repeat; bottom: 10px; left: 50%; transform: translateX(-50%); z-index: 6; cursor: pointer; transition: transform 0.5s ease, left 1s linear, bottom 1s linear; }
         .rabbit.hopping { animation: hop 0.5s ease-in-out; }
         @keyframes hop { 0%, 100% { transform: translate(-50%, 0); } 50% { transform: translate(-50%, -10px); } } /* Smaller hop */
         .bird { position: absolute; width: 22px; height: 18px; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><path d="M10 25 Q 25 10 40 25 Q 25 40 10 25" fill="skyblue"/><circle cx="35" cy="22" r="2" fill="black"/></svg>'); background-size: contain; background-repeat: no-repeat; z-index: 7; pointer-events: none; transition: left 1s linear, top 1s linear, opacity 0.5s ease; }
         .ladybug { position: absolute; width: 10px; height: 10px; background-color: red; border-radius: 50%; z-index: 8; pointer-events: none; }
         .bee { position: absolute; width: 12px; height: 8px; background-color: yellow; border: 1px solid black; z-index: 8; pointer-events: none; }
         .frog { position: absolute; width: 25px; height: 21px; background-color: green; border-radius: 12px 12px 0 0; bottom: 5px; left: 20%; z-index: 6; cursor: pointer; }
         .achievement-toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background-color: gold; color: #333; padding: 8px 15px; border-radius: 15px; box-shadow: 0 3px 8px rgba(0,0,0,0.3); z-index: 101; font-size: 0.95em; opacity: 0; transition: opacity 0.5s ease, bottom 0.5s ease; pointer-events: none; text-align: center; width: 80%; max-width: 300px; box-sizing: border-box; }
         .achievement-toast.show { opacity: 1; bottom: 90px; }
         .achievement-menu { display: none; position: fixed; top: 60px; /* Adjust top */ right: 15px; width: calc(100% - 30px); /* Use more width */ max-width: 250px; max-height: 40%; /* Limit height */ overflow-y: auto; background: rgba(255, 255, 255, 0.95); border: 2px solid #ff9d5c; border-radius: 10px; padding: 10px; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
         .achievement-menu h3 { margin: 0 0 10px 0; text-align: center; color: #ff9d5c; font-size: 1.1em; }
         .achievement-item { margin-bottom: 6px; font-size: 0.85em; }
         .achievement-item.unlocked { font-weight: bold; color: green; } .achievement-item.locked { color: grey; }
         .decoration { position: absolute; z-index: 5; cursor: grab; }
         .decoration.dragging { cursor: grabbing; opacity: 0.7; }
         .garden-bench { width: 70px; height: 35px; background-color: saddlebrown; } .bird-bath { width: 25px; height: 45px; background-color: lightgrey; } /* Add others... */
         .raindrop { position: absolute; width: 1px; /* Thinner */ height: 12px; background: linear-gradient(to bottom, rgba(173, 216, 230, 0), rgba(173, 216, 230, 0.8)); z-index: 9; pointer-events: none; animation: rain-fall linear infinite; border-radius: 1px; }
         @keyframes rain-fall { from { transform: translateY(-20px); } to { transform: translateY(calc(100vh + 20px)); } }
         body.raining .cloud { background-color: rgba(150, 150, 170, 0.8); }
         body.raining .sky { background: linear-gradient(to bottom, #778899, #B0C4DE); }
         body.raining .ground { filter: brightness(0.9); }
         .butterfly-net { position: absolute; width: 40px; height: 40px; border: 2px dashed grey; border-radius: 50%; opacity: 0; transition: opacity 0.2s ease; pointer-events: none; z-index: 100; transform: translate(-50%, -50%); }

        @keyframes sparkle-fade { 0% { transform: scale(0); opacity: 0; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }


        /* --- [NEW] Media Queries for Responsiveness --- */

        @media (max-width: 768px) {
             h1 {
                 font-size: 1.6em; /* Further reduce heading size */
             }

            .controls {
                bottom: 5px; /* Closer to edge */
                gap: 5px; /* Reduce gap further */
                padding: 6px; /* Reduce padding */
                width: 98%; /* Use more width */
            }

            .controls button {
                 font-size: 0.8em; /* Smaller text on buttons */
                 padding: 8px 10px; /* Adjust padding */
                 /* Maybe use icons + smaller text if still too crowded */
            }

            .instructions {
                 bottom: 65px; /* Adjust position based on new controls height */
                 font-size: 0.8em; /* Even smaller instructions */
                 padding: 6px 8px;
            }

            .message-container {
                 max-width: 85%; /* Allow slightly more width */
                 top: 10px;
                 left: 10px;
                 padding: 8px 10px;
            }
            .message-text { font-size: 0.9em; }
            .close-button { font-size: 0.85em; padding: 5px 10px; }

             .counter {
                 top: 10px;
                 right: 10px;
                 font-size: 0.9em;
                 padding: 6px 10px;
             }

             .achievement-menu {
                 top: 50px; /* Adjust position */
                 right: 10px;
                 width: calc(100% - 20px);
                 max-width: 220px;
             }

             /* Optional: Scale down garden elements slightly if needed */
             /* .flower { transform: translate(-50%, -100%) scale(0.9); } */
             /* .rabbit { transform: translate(-50%, -50%) scale(0.9); } */
        }

         @media (max-width: 480px) {
             /* Styles for even smaller screens */
             h1 {
                 font-size: 1.4em;
             }
             .controls button {
                 font-size: 0.75em; /* Even smaller text */
                 padding: 6px 8px;
                 min-width: 50px; /* Ensure minimum tap area */
             }
             .instructions {
                 bottom: 60px; /* Adjust again */
                 font-size: 0.75em;
             }
             .flower-message { font-size: 0.75em; max-width: 110px; }

             /* Consider hiding instructions text and relying on icons/initial message */
              /* .instructions { display: none; } */
         }


    </style>
</head>

<body>
    <div class="header">
        <h1>Ayda's Garden üçµ‚òÄÔ∏èüß°ü´∂üèºü¶û</h1> </div>

    <div class="garden-container" id="garden">
        <div class="sky" id="sky"></div>
        <div class="horizon"></div>
        <div class="ground" id="ground"></div>
        </div>

    <div class="message-container" id="messageContainer">
        <div class="message-text" id="messageText"></div>
        <button class="close-button" id="closeButton">Close</button>
    </div>

    <div class="counter" id="flowerCounter">
        Flowers: 0 / 15 </div>

     <div id="achievementToast" class="achievement-toast">
         Achievement Unlocked!
     </div>

     <div id="achievementMenu" class="achievement-menu">
         <h3>Achievements</h3>
         <div id="achievementList">
             </div>
         <button id="closeAchievementMenu" class="close-button" style="margin-top: 10px;">Close</button>
     </div>


    <div class="instructions">
        Tap ground to plant! Tap flowers/critters. Use buttons below!
    </div>

    <div class="controls">
        <button id="wateringCan">üöø Water</button>
        <button id="seasonToggle">‚òÄÔ∏è Season</button>
        <button id="dayNightToggle">‚òÄÔ∏è Day/Night</button>
        <button id="musicButton">üîä Music</button>
        <button id="achievementButton">üèÜ Achvmnts</button>
        <button id="weatherToggle">üå¶Ô∏è Weather</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- [Existing JS Code from previous version - No changes here] ---
            const garden = document.getElementById('garden');
            const ground = document.getElementById('ground');
            const sky = document.getElementById('sky');
            const messageContainer = document.getElementById('messageContainer');
            const messageText = document.getElementById('messageText');
            const closeButton = document.getElementById('closeButton');
            const flowerCounter = document.getElementById('flowerCounter');
            const wateringCanButton = document.getElementById('wateringCan');
            const seasonToggleButton = document.getElementById('seasonToggle');
            const dayNightToggleButton = document.getElementById('dayNightToggle');
            const musicButton = document.getElementById('musicButton');
            const body = document.body;
            const achievementToast = document.getElementById('achievementToast');
            const achievementButton = document.getElementById('achievementButton');
            const achievementMenu = document.getElementById('achievementMenu');
            const achievementList = document.getElementById('achievementList');
            const closeAchievementMenuButton = document.getElementById('closeAchievementMenu');
            const weatherToggleButton = document.getElementById('weatherToggle');
            let flowers = []; let butterflies = []; let clouds = []; let stars = []; let snowflakes = []; let raindrops = []; let creatures = []; let decorations = [];
            let waterMode = false; let maxFlowers = 25; /*<-- CONFIRM this is 15*/ let flowerCount = 0; let waterCount = 0; let currentSeason = 'summer'; let isNight = false; let musicPlaying = false; let gardenMusic = null; let currentWeather = 'sunny'; let butterflyCatchScore = 0;
            const achievements = { PLANTED_FIRST_FLOWER: { id: 'PLANTED_FIRST_FLOWER', name: 'First Bloom', description: 'Planted your first flower!', unlocked: false, reward: 'garden-bench' }, WATERED_10_TIMES: { id: 'WATERED_10_TIMES', name: 'Happy Hydrator', description: 'Watered flowers 10 times.', unlocked: false, reward: 'bird-bath' }, RAINBOW_GARDEN: { id: 'RAINBOW_GARDEN', name: 'Rainbow Garden', description: 'Grew flowers of 5+ different colors.', unlocked: false, reward: 'fountain' }, ALL_FLOWERS_GROWN: { id: 'ALL_FLOWERS_GROWN', name: 'Master Gardener', description: 'All flowers fully grown!', unlocked: false, reward: 'garden-gnome' }, };
            const decorationTypes = { 'garden-bench': { name: 'Garden Bench', styleClass: 'garden-bench' }, 'bird-bath': { name: 'Bird Bath', styleClass: 'bird-bath' }, 'fountain': { name: 'Fountain', styleClass: 'fountain' }, 'garden-gnome': { name: 'Garden Gnome', styleClass: 'garden-gnome' }, 'stepping-stones': { name: 'Stepping Stones', styleClass: 'stepping-stones' }, };
            function setupAudio() {
                try {
                    // Create the Audio object with your file name
                    gardenMusic = new Audio('wii-theme.mp3');

                    // Set it to loop
                    gardenMusic.loop = true;

                    // Set the volume (0.0 is silent, 1.0 is full volume)
                    gardenMusic.volume = 0.4;

                } catch (e) {
                    console.error("Could not create Audio element.", e);
                    // If there's an error (e.g., file not found), set gardenMusic to null
                    gardenMusic = null;
                }
            }
            setupAudio(); // Call the function to set up the audio
            musicButton.addEventListener('click', toggleMusic); wateringCanButton.addEventListener('click', toggleWaterMode); seasonToggleButton.addEventListener('click', toggleSeason); dayNightToggleButton.addEventListener('click', toggleDayNight); closeButton.addEventListener('click', () => messageContainer.style.display = 'none'); achievementButton.addEventListener('click', toggleAchievementMenu); closeAchievementMenuButton.addEventListener('click', toggleAchievementMenu); weatherToggleButton.addEventListener('click', cycleWeather);
            garden.addEventListener('click', (e) => { if (gardenMusic && !musicPlaying && gardenMusic?.paused) { playMusic(); } if (e.target.classList.contains('decoration')) { startDraggingDecoration(e.target, e); return; } if (e.target.classList.contains('creature')) { handleCreatureClick(e.target); return; } const plantAllowed = checkPlantingAllowed(e.clientX, e.clientY); if (!plantAllowed) return; const color = prompt("Flower color (e.g., red, blue):", "orange"); if (!color) return; setTimeout(() => { createFlower(e.clientX, e.clientY, flowerCount, color); flowerCount++; updateFlowerCounter(); checkAchievement('PLANTED_FIRST_FLOWER'); }, 300); });
            function checkPlantingAllowed(x, y) { if (flowerCount >= maxFlowers) { showMessage("Your garden is full! üå∏"); return false; } const groundRect = ground.getBoundingClientRect(); if (y < groundRect.top || y > groundRect.bottom || x < groundRect.left || x > groundRect.right) { showMessage("Flowers grow in the ground! üå±"); return false; } const tooClose = flowers.some(flower => { const flowerRect = flower.element.getBoundingClientRect(); const distance = Math.sqrt(Math.pow(x - flowerRect.left - flowerRect.width / 2, 2) + Math.pow(y - flowerRect.top - flowerRect.height / 2, 2)); return distance < 60; /* Reduced min distance slightly */ }); if (tooClose) { showMessage("Give the flowers space! üå±"); return false; } return true; }
            function createFlower(x, y, index, color) { const flower = document.createElement('div'); flower.className = 'flower'; const gardenRect = garden.getBoundingClientRect(); const absoluteX = x - gardenRect.left; const absoluteY = y - gardenRect.top; flower.style.left = `${absoluteX}px`; flower.style.top = `${absoluteY}px`; flower.dataset.index = index; flower.dataset.color = color; const stem = document.createElement('div'); stem.className = 'flower-stem'; flower.appendChild(stem); if (currentSeason !== 'winter') { const leafLeft = document.createElement('div'); leafLeft.className = 'leaf left'; stem.appendChild(leafLeft); const leafRight = document.createElement('div'); leafRight.className = 'leaf right'; stem.appendChild(leafRight); } const head = document.createElement('div'); head.className = 'flower-head'; flower.appendChild(head); const waterMeterContainer = document.createElement('div'); waterMeterContainer.className = 'water-meter-container'; flower.appendChild(waterMeterContainer); const waterMeterFill = document.createElement('div'); waterMeterFill.className = 'water-meter-fill'; waterMeterContainer.appendChild(waterMeterFill); const flowerMessage = document.createElement('div'); flowerMessage.className = 'flower-message'; flowerMessage.textContent = getRandomMessage(); flower.appendChild(flowerMessage); const petalCount = 8; for (let i = 0; i < petalCount; i++) { const petal = document.createElement('div'); petal.className = 'petal'; petal.style.backgroundColor = color; head.appendChild(petal); } const center = document.createElement('div'); center.className = 'flower-center'; head.appendChild(center); const flowerObj = { element: flower, growState: 0, waterLevel: 0, grown: false, messageElement: flowerMessage, color: color.toLowerCase(), index: index }; flowers.push(flowerObj); garden.appendChild(flower); createSparkles(flower, 5); animateGrowth(flowerObj); flower.addEventListener('click', (e) => { e.stopPropagation(); handleFlowerClick(flowerObj); }); setTimeout(() => showFlowerMessage(flowerObj), 1000); checkRainbowGardenAchievement(); return flower; }
            function handleFlowerClick(flowerObj) { if (!flowerObj) return; if (waterMode) { if (!flowerObj.grown) { flowerObj.waterLevel = Math.min(100, flowerObj.waterLevel + 33); const waterMeter = flowerObj.element.querySelector('.water-meter-fill'); if (waterMeter) waterMeter.style.width = `${flowerObj.waterLevel}%`; createWaterDroplets(parseFloat(flowerObj.element.style.left), parseFloat(flowerObj.element.style.top)); waterCount++; checkAchievement('WATERED_10_TIMES', waterCount >= 10); if (flowerObj.waterLevel >= 100) { flowerObj.grown = true; animateFullGrowth(flowerObj); showMessage(`Flower #${flowerObj.index + 1} is fully grown! üå∫`, 2000); checkAllFlowersGrown(); } else { showMessage(`Watering Flower #${flowerObj.index + 1}. (${flowerObj.waterLevel}%) üíß`, 1500); } } else { showMessage(`This ${flowerObj.color} flower is grown! ü•≥`, 1500); } } else { showFlowerMessage(flowerObj); } }
            function getRandomMessage() { const msgs = [ "Did you feel it?",
                                                         "Can't wait to live the rest of my life with you",
                                                         "Good thing you're pretty, you're also a lil annoying!",
                                                         "You're as beautiful as the flowers you love to grow! üå∑",
                                                         "Your laughter is my favorite sound in the world",
                                                         "The way you see the world is amazing, although very concerning",
                                                         "I'm so grateful to have you in my life Ayda!",
                                                         "Matchiana? More like wifey-ana",
                                                         "You better like this cause i took a lot of time making it",
                                                         "Where do you reckon our sky lanterns are rn?",
                                                         "Every day with you feels like spring in this garden üå∏",
                                                         "Your smile could make these flowers grow without water ‚òÄÔ∏è",
                                                         "Remember our first date? yeah, me neither. I'll see you in Abuja though",
                                                         "I love how you scrunch your nose when you laugh",
                                                         "Our love story is my favorite book that never ends ‚ù§Ô∏è",
                                                         "Whenever I miss you, I imagine you tending to these flowers",
                                                         "You're the soil to my seeds - you help me grow in ways I never imagined",
                                                         "If our future home doesn't have a garden for you, I'm building one immediately",
                                                         "The universe knew what it was doing when it brought us together",
                                                         "Your heart is even more beautiful than this garden could ever be",
                                                         "Imagine us, gray-haired, still caring for plants together someday",
                                                         "You've planted yourself in my heart and I hope you stay there forever",
                                                         "When you talk about plants, your eyes light up like stars ‚ú®",
                                                         "I hope this garden makes you smile half as much as you make me smile",
                                                         "This garden will always be here for you - just like me üåø" ]; return msgs[Math.floor(Math.random()*msgs.length)]; }
            function showMessage(msg, duration = 3000) { messageText.innerHTML = msg; messageContainer.style.display = 'block'; if (duration > 0) { setTimeout(() => { if (messageText.innerHTML === msg) { messageContainer.style.display = 'none'; } }, duration); } } function showPermanentMessage(msg) { showMessage(msg, 0); }
            function showFlowerMessage(flowerObj) { if (!flowerObj || !flowerObj.messageElement) return; flowerObj.messageElement.style.opacity = '1'; setTimeout(() => { if (flowerObj.messageElement) flowerObj.messageElement.style.opacity = '0'; }, 3000); }
            function updateFlowerCounter() { flowerCounter.textContent = `Flowers: ${flowerCount} / ${maxFlowers}`; }
            function animateGrowth(flowerObj) { const el = flowerObj.element; const stem = el.querySelector('.flower-stem'); const head = el.querySelector('.flower-head'); if (!stem || !head) return; head.style.opacity = '0'; head.style.transform = 'translateX(-50%) scale(0)'; stem.style.height = '0px'; let h = 0; const grow = setInterval(() => { h += 2; stem.style.height = `${h}px`; if (h >= 60) { clearInterval(grow); setTimeout(() => { head.style.opacity = '1'; head.style.transform = 'translateX(-50%) scale(1)'; createButterfly(); }, 300); } }, 30); }
            function animateFullGrowth(flowerObj) { const el = flowerObj.element; const head = el.querySelector('.flower-head'); const stem = el.querySelector('.flower-stem'); const petals = el.querySelectorAll('.petal'); const leaves = el.querySelectorAll('.leaf'); if (!el || !head || !stem) return; el.style.height = '120px'; head.style.transform = 'translateX(-50%) scale(1.3)'; head.style.top = '-5px'; stem.style.height = '85px'; stem.style.width = '5px'; petals.forEach(p => { p.style.width = '18px'; p.style.height = '18px'; p.style.filter = 'brightness(1.2)'; }); leaves.forEach(l => { if (l) { l.style.width = '25px'; l.style.height = '12px'; } }); createSparkles(el, 10, true); createButterfly(); createButterfly(); }
            function createSparkles(el, count, bright = false) { for (let i=0; i<count; i++) { setTimeout(() => { const s = document.createElement('div'); s.style.position='absolute'; s.style.width = bright?'10px':'8px'; s.style.height = bright?'10px':'8px'; s.style.backgroundColor='gold'; s.style.borderRadius='50%'; s.style.opacity='0.8'; s.style.zIndex='5'; s.style.pointerEvents='none'; const a = Math.random()*Math.PI*2; const d = 20+Math.random()*(bright?40:30); s.style.left = `calc(50% + ${Math.cos(a)*d}px)`; s.style.top = `calc(20% + ${Math.sin(a)*d}px)`; s.style.animation=`sparkle-fade 1.5s ease-out forwards`; el.appendChild(s); setTimeout(() => s.remove(), 1500); }, i * (bright ? 100 : 200)); } }
            function createWaterDroplets(x, y) { for (let i=0; i<10; i++) { const d=document.createElement('div'); d.style.position='absolute'; d.style.width='6px'; d.style.height='12px'; d.style.backgroundColor='rgba(135, 206, 250, 0.7)'; d.style.borderRadius='50%'; d.style.zIndex='5'; d.style.pointerEvents='none'; const ox=(Math.random()-0.5)*40; const sy=y-60; d.style.left=`${x+ox}px`; d.style.top=`${sy}px`; d.style.transition='top 0.8s ease-in, opacity 0.8s ease-in'; garden.appendChild(d); void d.offsetWidth; d.style.top=`${sy+50}px`; d.style.opacity='0'; setTimeout(()=>d.remove(), 800); } }
            function createButterfly(fx, fy) { if (butterflies.length >= 8) return; const b = document.createElement('div'); b.className = 'butterfly'; const gr = garden.getBoundingClientRect(); const x = fx !== undefined ? fx : Math.random() * gr.width; const y = fy !== undefined ? fy : Math.random() * gr.height * 0.8; b.style.left = `${x}px`; b.style.top = `${y}px`; const body = document.createElement('div'); body.className = 'butterfly-body'; b.appendChild(body); const w1 = document.createElement('div'); w1.className = 'butterfly-wing'; b.appendChild(w1); const w2 = document.createElement('div'); w2.className = 'butterfly-wing'; b.appendChild(w2); const colors = ['#FFA500', '#FF8C00', '#FFD700', '#FFFF00', '#FF69B4', '#87CEFA']; const rc = colors[Math.floor(Math.random() * colors.length)]; w1.style.backgroundColor = rc; w2.style.backgroundColor = rc; b.addEventListener('click', handleButterflyCatch); garden.appendChild(b); const bd = { element: b, x: x, y: y, speed: 1 + Math.random() * 1.5, angle: Math.random() * Math.PI * 2, caught: false }; butterflies.push(bd); setTimeout(() => { if (!bd.caught) { b.remove(); butterflies = butterflies.filter(bf => bf.element !== b.element); } }, 20000 + Math.random() * 10000); }
            function createCloud() { if (clouds.length >= (currentWeather === 'raining' ? 6 : 4)) return; const cg = document.createElement('div'); cg.style.position='absolute'; cg.style.top=`${10 + Math.random() * 40}px`; cg.style.left=`${-150}px`; cg.style.zIndex='1'; cg.style.pointerEvents='none'; const np = 3 + Math.floor(Math.random() * 4); for (let i=0; i<np; i++) { const cp = document.createElement('div'); cp.className='cloud'; const sz=40+Math.random()*50; cp.style.width=`${sz}px`; cp.style.height=`${sz}px`; cp.style.position='absolute'; cp.style.top=`${(Math.random()-0.5)*20}px`; cp.style.left=`${i*25+(Math.random()-0.5)*10}px`; cg.appendChild(cp); } sky.appendChild(cg); const cd = { element: cg, speed: 0.3 + Math.random() * (currentWeather === 'raining' ? 0.6 : 0.4) }; clouds.push(cd); }
            function createStars(c=50) { stars.forEach(s=>s.remove()); stars=[]; for (let i=0; i<c; i++) { const s=document.createElement('div'); s.className='star'; s.style.left=`${Math.random()*100}%`; s.style.top=`${Math.random()*100}%`; s.style.animationDelay=`${Math.random()*2}s`; sky.appendChild(s); stars.push(s); } }
            function createSnow(c=30) { snowflakes.forEach(f=>f.remove()); snowflakes=[]; for (let i=0; i<c; i++) { const f=document.createElement('div'); f.className='snowflake'; f.style.left=`${Math.random()*100}%`; f.style.top=`${Math.random()*-50}px`; const d=5+Math.random()*5; f.style.animationDuration=`${d}s`; f.style.animationDelay=`${Math.random()*d}s`; ground.appendChild(f); snowflakes.push(f); } }
            function createRain(c=50) { clearRain(); for (let i=0; i<c; i++) { const d=document.createElement('div'); d.className='raindrop'; d.style.left=`${Math.random()*100}%`; const dur=0.5+Math.random()*0.5; d.style.animationDuration=`${dur}s`; d.style.animationDelay=`${Math.random()*dur}s`; garden.appendChild(d); raindrops.push(d); } } function clearRain() { raindrops.forEach(d=>d.remove()); raindrops=[]; }
            function toggleMusic() { if (!gardenMusic) { showMessage("Music player not ready.", 2000); return; } if (musicPlaying) { gardenMusic.pause(); musicButton.textContent = 'üîä Music'; } else { playMusic(); } musicPlaying = !musicPlaying; } function playMusic() { if (!gardenMusic) return; gardenMusic.play().then(() => { musicButton.textContent = 'üîá Music'; musicPlaying = true; }).catch(e => { showMessage("Browser blocked music autoplay.", 3000); musicPlaying = false; musicButton.textContent = 'üîä Music'; }); }
            function toggleWaterMode() { waterMode = !waterMode; wateringCanButton.classList.toggle('active', waterMode); if (waterMode) { showMessage("Watering mode ON! üíß", 2000); garden.style.cursor = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="blue" viewBox="0 0 16 16"><path d="M13 2.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v1h-1V2a.5.5 0 0 0-.5-.5H4a.5.5 0 0 0-.5.5v3.793L.293 7.707a.5.5 0 0 0-.06 0L0 7.5v1l.004.058a.5.5 0 0 0 .496.442l.754.05V13a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V9.05l.754-.05a.5.5 0 0 0 .496-.442L13 8.5v-1l-.293-.293a.5.5 0 0 0-.06-.058zM12 8.386l-.754.05a1.5 1.5 0 0 1-.496.442l.25 1.614A.5.5 0 0 1 11 11V8.5h1v-.114zM4.5 3h1v1h-1V3zm-1 0h1v1h-1V3zm6 9H3V9.05l-.25-1.614A1.5 1.5 0 0 1 2.254 7l-.754-.05V6.614L3 5.707V4h7v7zM10 4.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z"/></svg>') 4 12, auto`; } else { garden.style.cursor = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="%23964B00" stroke="%23964B00" stroke-width="2"><path d="M7 17l3-3 5 5 5-5-3-3 3-3-5-5-3 3-3-3-5 5 3 3-3 3z"/></svg>'), auto`; } }
            function toggleSeason() { body.classList.remove(currentSeason); snowflakes.forEach(f => f.remove()); snowflakes = []; clearRain(); body.classList.remove('raining'); if (currentSeason === 'summer') { currentSeason = 'fall'; seasonToggleButton.textContent = 'üçÇ Season'; } else if (currentSeason === 'fall') { currentSeason = 'winter'; seasonToggleButton.textContent = '‚ùÑÔ∏è Season'; createSnow(); document.querySelectorAll('.leaf').forEach(l => l.style.display = 'none'); creatures.forEach(c => { if (c.type === 'rabbit') c.element.style.filter = 'brightness(1.5)'; }); } else { currentSeason = 'summer'; seasonToggleButton.textContent = '‚òÄÔ∏è Season'; document.querySelectorAll('.leaf').forEach(l => l.style.display = 'block'); creatures.forEach(c => { if (c.type === 'rabbit') c.element.style.filter = ''; }); } body.classList.add(currentSeason); updateWeatherEffects(); showMessage(`Season: ${currentSeason}!`, 2000); }
            function toggleDayNight() { isNight = !isNight; body.classList.toggle('night', isNight); dayNightToggleButton.textContent = isNight ? 'üåô Day/Night' : '‚òÄÔ∏è Day/Night'; if (isNight) { createStars(); } else { stars.forEach(s=>s.remove()); stars=[]; } updateWeatherEffects(); toggleGnomeVisibility(isNight); showMessage(isNight ? "Night time ‚ú®" : "Day time ‚òÄÔ∏è", 2000); }
            function addCreature(type) { let el; let cd = { type: type, element: null, x: 0, y: 0, state: 'idle', targetX: 0, targetY: 0 }; const gr = garden.getBoundingClientRect(); const glY = gr.height * 0.95; switch(type) { case 'rabbit': if (creatures.filter(c=>c.type==='rabbit').length >= 2) return; el = document.createElement('div'); el.className = 'rabbit creature'; cd.x = Math.random() * gr.width * 0.8 + gr.width * 0.1; cd.y = glY - el.offsetHeight; el.style.left = `${cd.x}px`; el.style.bottom = `10px`; creatures.push(cd); break; case 'bird': if (creatures.filter(c=>c.type==='bird').length >= 3) return; el = document.createElement('div'); el.className = 'bird creature'; cd.x = -30; cd.y = gr.height * (0.1 + Math.random() * 0.2); el.style.left = `${cd.x}px`; el.style.top = `${cd.y}px`; cd.state = 'flying'; creatures.push(cd); break; case 'frog': if (creatures.find(c=>c.type==='frog')) return; el = document.createElement('div'); el.className = 'frog creature'; cd.x = gr.width * (0.1 + Math.random() * 0.2); el.style.left = `${cd.x}px`; el.style.bottom = `5px`; creatures.push(cd); break; default: return; } if (el) { cd.element = el; garden.appendChild(el); el.addEventListener('click', (e) => { e.stopPropagation(); handleCreatureClick(cd); }); } }
            function handleCreatureClick(cDataOrEl) { let cd = cDataOrEl; if (cDataOrEl instanceof HTMLElement) { cd = creatures.find(c => c.element === cDataOrEl); } if (!cd) return; switch(cd.type) { case 'rabbit': showMessage("Hop hop!", 1500); cd.element.classList.add('hopping'); setTimeout(() => cd.element.classList.remove('hopping'), 500); setRabbitTarget(cd, true); break; case 'frog': showMessage("Ribbit!", 1000); break; case 'bird': showMessage("Chirp!", 1000); break; default: showMessage("Garden friend!", 1500); } }
            function updateCreatures() { const gr = garden.getBoundingClientRect(); const glY = gr.height * 0.95; creatures.forEach(c => { if (!c.element) return; switch(c.type) { case 'rabbit': updateRabbit(c, gr, glY); break; case 'bird': updateBird(c, gr); break; case 'frog': if (Math.random() < 0.001) {} break; } }); }
            function updateRabbit(r, gr, gY) { const spd = 1; const chgTgt = 0.01; const idleT = 2000; if (r.state === 'idle') { if (!r.idleTimer) { r.idleTimer = setTimeout(() => { r.state = 'hopping'; setRabbitTarget(r); r.idleTimer = null; }, idleT * (0.5 + Math.random())); } } else if (r.state === 'hopping') { const dx = r.targetX - r.x; const dy = r.targetY - r.y; const dist = Math.sqrt(dx*dx + dy*dy); if (dist < spd * 2) { r.x = r.targetX; r.state = 'idle'; r.element.classList.remove('hopping'); } else { r.x += (dx / dist) * spd; r.element.style.left = `${r.x}px`; r.element.classList.add('hopping'); if (Math.random() < chgTgt / 5) { setRabbitTarget(r); } } if (Math.random() < chgTgt) { setRabbitTarget(r); } } else { r.state = 'idle'; } }
            function setRabbitTarget(r, far = false) { const gr = garden.getBoundingClientRect(); const hopD = far ? 300 : 50 + Math.random() * 100; const ang = Math.random() * Math.PI * 2; let nX = r.x + Math.cos(ang) * hopD; nX = Math.max(20, Math.min(gr.width - 20, nX)); r.targetX = nX; r.targetY = r.y; r.state = 'hopping'; if (r.idleTimer) { clearTimeout(r.idleTimer); r.idleTimer = null; } }
            function updateBird(b, gr) { const spd = 1.5 + Math.random() * 1; const chgTgt = 0.02; if (!b.targetX || Math.random() < chgTgt) { b.targetX = Math.random() * gr.width; b.targetY = gr.height * (0.1 + Math.random() * 0.3); } const dx = b.targetX - b.x; const dy = b.targetY - b.y; const dist = Math.sqrt(dx*dx + dy*dy); if (dist < spd * 5) { b.targetX = Math.random() * gr.width; b.targetY = gr.height * (0.1 + Math.random() * 0.3); } else { b.x += (dx / dist) * spd; b.y += (dy / dist) * spd; } if (b.x > gr.width + 30 || b.x < -30) { b.x = -30; b.y = gr.height * (0.1 + Math.random() * 0.2); b.targetX = Math.random() * gr.width; b.targetY = gr.height * (0.1 + Math.random() * 0.3); } b.element.style.left = `${b.x}px`; b.element.style.top = `${b.y}px`; }
            function checkAchievement(achId, cond = true) { const ach = achievements[achId]; if (ach && !ach.unlocked && cond) { unlockAchievement(achId); } }
            function unlockAchievement(achId) { const ach = achievements[achId]; if (!ach || ach.unlocked) return; ach.unlocked = true; console.log(`Unlocked: ${ach.name}`); achievementToast.textContent = `üèÜ Unlocked: ${ach.name}!`; achievementToast.classList.add('show'); setTimeout(() => { achievementToast.classList.remove('show'); }, 4000); if (ach.reward && decorationTypes[ach.reward]) { showMessage(`Unlocked ${decorationTypes[ach.reward].name}! Drag from top-left.`, 5000); createPlaceableDecoration(ach.reward); } updateAchievementMenu(); }
            function toggleAchievementMenu() { if (achievementMenu.style.display === 'block') { achievementMenu.style.display = 'none'; } else { updateAchievementMenu(); achievementMenu.style.display = 'block'; } }
            function updateAchievementMenu() { achievementList.innerHTML = ''; for (const id in achievements) { const ach = achievements[id]; if (!ach.secret || ach.unlocked) { const d = document.createElement('div'); d.className = `achievement-item ${ach.unlocked ? 'unlocked' : 'locked'}`; d.textContent = `${ach.unlocked ? 'üèÜ' : 'üîí'} ${ach.name}: ${ach.description}`; achievementList.appendChild(d); } } }
            function checkRainbowGardenAchievement() { if (achievements.RAINBOW_GARDEN.unlocked) return; const uc = new Set(); flowers.forEach(f => uc.add(f.color)); if (uc.size >= 5) { checkAchievement('RAINBOW_GARDEN'); } }
            function createPlaceableDecoration(decorId) { const dt = decorationTypes[decorId]; if (!dt) return; const de = document.createElement('div'); de.className = `decoration ${dt.styleClass}`; de.dataset.decorId = decorId; de.style.left = '20px'; de.style.top = '150px'; de.title = `Draggable ${dt.name}`; de.addEventListener('mousedown', (e) => { e.preventDefault(); startDraggingDecoration(de, e); }); garden.appendChild(de); decorations.push({ id: decorId, element: de }); if (decorId === 'garden-gnome') { de.dataset.activeAtNight = true; toggleGnomeVisibility(isNight); } } let draggedElement = null; let offsetX, offsetY; function startDraggingDecoration(el, ev) { if (!el.classList.contains('decoration')) return; draggedElement = el; draggedElement.classList.add('dragging'); const rect = draggedElement.getBoundingClientRect(); offsetX = ev.clientX - rect.left; offsetY = ev.clientY - rect.top; window.addEventListener('mousemove', dragDecoration); window.addEventListener('mouseup', stopDraggingDecoration); window.addEventListener('mouseleave', stopDraggingDecoration); } function dragDecoration(ev) { if (!draggedElement) return; const gr = garden.getBoundingClientRect(); let nX = ev.clientX - gr.left - offsetX; let nY = ev.clientY - gr.top - offsetY; const elR = draggedElement.getBoundingClientRect(); nX = Math.max(0, Math.min(gr.width - elR.width, nX)); const gtO = gr.height * 0.33; nY = Math.max(gtO, Math.min(gr.height - elR.height, nY)); draggedElement.style.left = `${nX}px`; draggedElement.style.top = `${nY}px`; } function stopDraggingDecoration() { if (draggedElement) { draggedElement.classList.remove('dragging'); draggedElement = null; window.removeEventListener('mousemove', dragDecoration); window.removeEventListener('mouseup', stopDraggingDecoration); window.removeEventListener('mouseleave', stopDraggingDecoration); } } function toggleGnomeVisibility(show) { const g = decorations.find(d => d.id === 'garden-gnome'); if (g && g.element) { g.element.style.display = show ? 'block' : 'none'; } }
            function cycleWeather() { body.classList.remove('raining'); clearRain(); if (currentWeather === 'sunny') { currentWeather = 'cloudy'; } else if (currentWeather === 'cloudy') { currentWeather = 'raining'; } else { currentWeather = 'sunny'; } updateWeatherEffects(); showMessage(`Weather: ${currentWeather}.`, 2000); }
            function updateWeatherEffects() { clearRain(); body.classList.remove('raining'); switch(currentWeather) { case 'sunny': weatherToggleButton.textContent = '‚òÄÔ∏è Weather'; break; case 'cloudy': weatherToggleButton.textContent = '‚òÅÔ∏è Weather'; break; case 'raining': weatherToggleButton.textContent = 'üåßÔ∏è Weather'; body.classList.add('raining'); createRain(); applyRainWatering(); break; } clouds.forEach(c=>c.element.remove()); clouds=[]; if (!isNight) { const cloudChance = currentWeather === 'raining' ? 0.8 : (currentWeather === 'cloudy' ? 0.6 : 0.3); if (Math.random() < cloudChance) setTimeout(createCloud, 500); if (Math.random() < cloudChance) setTimeout(createCloud, 1500); } }
            function applyRainWatering() { let wc = 0; flowers.forEach(fO => { if (!fO.grown) { const wA = 15; fO.waterLevel = Math.min(100, fO.waterLevel + wA); const wM = fO.element.querySelector('.water-meter-fill'); if (wM) wM.style.width = `${fO.waterLevel}%`; if (fO.waterLevel >= 100) { fO.grown = true; animateFullGrowth(fO); wc++; } } }); if (wc > 0) { checkAllFlowersGrown(); } showMessage("Rain watering flowers! üíß", 3000); }
            function handleButterflyCatch(ev) { ev.stopPropagation(); const bEl = ev.currentTarget; const bD = butterflies.find(b => b.element === bEl); if (bD && !bD.caught) { bD.caught = true; butterflyCatchScore++; showMessage(`Caught butterfly! Score: ${butterflyCatchScore} ü¶ã`, 1500); showCatchEffect(bD.x, bD.y); bEl.style.opacity = '0'; bEl.style.pointerEvents = 'none'; setTimeout(() => { bEl.remove(); butterflies = butterflies.filter(b => b !== bD); }, 500); } } function showCatchEffect(x, y) { const n = document.createElement('div'); n.className = 'butterfly-net'; n.style.left = `${x}px`; n.style.top = `${y}px`; garden.appendChild(n); n.style.opacity = '1'; setTimeout(() => { n.style.opacity = '0'; setTimeout(() => n.remove(), 200); }, 300); }
            function animateElements() { butterflies.forEach(b => { if (b.caught) return; if (Math.random() < 0.02) b.angle += (Math.random() - 0.5) * Math.PI / 4; b.x += Math.cos(b.angle) * b.speed; b.y += Math.sin(b.angle) * b.speed * 0.3; const gr = garden.getBoundingClientRect(); if (b.x < -30) b.x = gr.width + 20; if (b.x > gr.width + 30) b.x = -20; if (b.y < -30) b.y = gr.height + 20; if (b.y > gr.height + 30) b.y = -20; b.element.style.left = `${b.x}px`; b.element.style.top = `${b.y}px`; }); clouds.forEach((c, i) => { const l = parseFloat(c.element.style.left) || -150; c.element.style.left = `${l + c.speed}px`; if (l > window.innerWidth + 150) { c.element.remove(); clouds.splice(i, 1); } }); updateCreatures(); requestAnimationFrame(animateElements); }
            function checkAllFlowersGrown() { if (flowerCount < maxFlowers) return; const allGrown = flowers.every(f => f.grown); if (allGrown) { checkAchievement('ALL_FLOWERS_GROWN'); if (!garden.dataset.celebrated) { garden.dataset.celebrated = 'true'; celebrateGardenCompletion(); } } }
            function celebrateGardenCompletion() { showMessage("Garden complete & beautiful! üíñüéâüåà", 5000); for (let i=0; i<10; i++) setTimeout(createButterfly, i*200); for (let i=0; i<30; i++) { setTimeout(() => { const s=document.createElement('div'); s.style.position='absolute'; s.style.width='12px'; s.style.height='12px'; s.style.backgroundColor=['gold','pink','lightblue'][Math.floor(Math.random()*3)]; s.style.borderRadius='50%'; s.style.opacity='0.9'; s.style.zIndex='101'; s.style.left=`${Math.random()*100}%`; s.style.top=`${Math.random()*100}%`; s.style.animation='sparkle-fade 2s ease-out forwards'; garden.appendChild(s); setTimeout(() => s.remove(), 2000); }, i*100); } }
            function initializeGarden() { updateFlowerCounter(); updateAchievementMenu(); animateElements(); setInterval(() => { if (Math.random() < 0.4) createButterfly(); }, 5000); setInterval(() => { if (Math.random() < 0.3 && !isNight && currentWeather !== 'raining') createCloud(); }, 8000); setInterval(() => { if (Math.random() < 0.15) addCreature('rabbit'); }, 15000); setInterval(() => { if (Math.random() < 0.1) addCreature('bird'); }, 20000); setTimeout(() => addCreature('frog'), 5000); setTimeout(createCloud, 1000); setTimeout(() => addCreature('rabbit'), 3000); setTimeout(() => { showMessage("Welcome! Tap ground to plant. Explore buttons. üåªüíñ", 5000); }, 1500); }
            initializeGarden();
        });
    </script>
     </body>

</html>